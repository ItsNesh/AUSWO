<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Login Page</title>
    <link rel="stylesheet" href="/stylesheets/Login.css">
    <link rel="stylesheet" href="/stylesheets/Global.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

</head>
<body>
    <div id="app">
        <nav class="navbar">
            <a class="brand" href="/index.html">AUSWO</a>
            <div class="nav-links" v-if="sessionInfo !== null">
                <a href="/points-calculator.html">Points Calculator</a>
                <a href="/Dashboard.html">Dashboard</a>
                <a href="/Profile.html">Profile</a>
                <a href="/account.html">Account</a>
                <a href="/Login.html" v-if="!isLoggedIn">Log In</a>
                <a href="/auth/logout" v-if="isLoggedIn" @click.prevent="logout">Log Out</a>
            </div>
        </nav>
        <div class="container">
            <div class="form-side">
                <main>
                    <h1>Login Page</h1>
                    <form id="login-signup-form" @submit.prevent="login">
                        <div class="form-group">
                            <label for="login-signup-username">Username:</label>
                            <br />
                            <input type="text" id="login-signup-username" name="login-signup-username" placeholder="John_B" required>
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-password">Password:</label>
                            <br />
                            <input type="password" id="login-signup-password" name="login-signup-password" required>                
                            <br /><br />
                        </div>

                        <div class="form-group checkbox-group">
                            <input type="checkbox" value="remember-me" id="remember-me" name="remember-me">
                            <label for="remember-me">Remember Me</label>
                        </div>
                        <button type="submit">Login</button>
                        <a @click="loginWithGoogle" class="google-signin-button">
                        <img src="https://banner2.cleanpng.com/20180423/gkw/kisspng-google-logo-logo-logo-5ade7dc753b015.9317679115245306313428.jpg" alt="Google Logo">
                        Sign in with Google
                    </a>           
                    </form>
                    <p>Dont have an account yet? <a href="Signup.html">Sign up</a></p>
                </main>
            </div>
            <div class="image-side">
                <img src="/images/People-Happy.jpg" alt="Login Illistration">
            </div>
        </div>
    </div>
    <script>
      new Vue({
          el: '#app',
          data: {
              isLoggedIn: false, // Assume initially not logged in
              sessionInfo: null
          },
          mounted() {
              // Check if the user is logged in (check for userID in localStorage)
              this.isLoggedIn = !!localStorage.getItem('userID');
              this.fetchSessionInfo();
          },
          methods: {
              async login(event) {
                  event.preventDefault();
                  const username = document.getElementById('login-signup-username').value;
                  const password = document.getElementById('login-signup-password').value;

                  try {
                      const response = await fetch('/auth/login', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ userName: username, password: password })
                      });

                      if (!response.ok) {
                          throw new Error('Login failed');
                      }

                      const data = await response.json();
                      localStorage.setItem('userID', data.userID); // Save the userID in local storage
                      this.isLoggedIn = true; // Update the login state
                      window.location.href = data.redirect || '/index.html'; // Redirect after login
                  } catch (error) {
                      alert('Login failed');
                  }
              },
              loginWithGoogle() {
                  window.location.href = '/auth/google';
              },
              logout() {
                  // Remove the userID from localStorage
                  localStorage.removeItem('userID');
                  // Set the logged-in state to false
                  this.isLoggedIn = false;
                  // Redirect to the homepage or login page
                  window.location.href = '/Login.html';
              },
              async fetchSessionInfo() {
                  try {
                      const response = await fetch('/auth/session-info');
                      if (!response.ok) throw new Error('Failed to fetch session info');
                      const data = await response.json();
                      this.sessionInfo = data;
                  } catch (error) {
                      console.error('Error fetching session info:', error);
                      this.sessionInfo = 'No session information available';
                  }
              }
          }
      });
  </script>
</body>
</html>
