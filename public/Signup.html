<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Signup Page</title>
    <link rel="stylesheet" href="/stylesheets/Signup.css">
    <link rel="stylesheet" href="/stylesheets/Global.css">
    <script>
        async function validateForm(event) {
            event.preventDefault();

            const firstName = document.getElementById('login-signup-first-name').value;
            const lastName = document.getElementById('login-signup-last-name').value;
            const phoneNumber = document.getElementById('login-signup-phonenumber').value;
            const email = document.getElementById('login-signup-email').value;
            const userName = document.getElementById('login-signup-username').value;
            const password = document.getElementById('login-signup-password').value;
            const confirmPassword = document.getElementById('login-signup-repeat-password').value;

            const errorList = document.getElementById('errorList');
            errorList.innerHTML = ''; // Clear existing errors

            if (password !== confirmPassword) {
                const li = document.createElement('li');
                li.textContent = 'Passwords do not match!';
                errorList.appendChild(li);
                return;
            }

            const response = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ firstName, lastName, phoneNumber, email, userName, password, confirmPassword })
            });

            const result = await response.json();
            if (response.status !== 201) {
                displayErrors(result.errors);
            } else {
                window.location.href = result.redirect; // Redirect to the login page
            }
        }

        function displayErrors(errors) {
            const errorList = document.getElementById('errorList');
            errors.forEach(error => {
                const li = document.createElement('li');
                li.textContent = error.msg;
                errorList.appendChild(li);
            });
        }
    </script>
</head>
<body>
    <nav class="navbar">
        <a class="brand" href="/index.html">AUSWO</a>
        <div class="nav-links" v-if="sessionInfo !== null">
            <a href="/points-calculator.html">Points Calculator</a>
            <a href="/Dashboard.html">Dashboard</a>
            <a href="/Profile.html">Profile</a>
            <a href="/account.html">Account</a>
            <a href="/Login.html" v-if="!isLoggedIn">Log In</a>
        </div>
    </nav>
    <div class="container">
        <div class="form-side">
            <main>
                <h1>Sign Up Page</h1>
                <ul id="errorList" style="color: red; margin-bottom: 20px;"></ul>
                <form id="login-signup-form" onsubmit="return validateForm(event)"> 
                    <div class="form-group">
                        <label for="login-signup-first-name">First Name:</label>
                        <br />
                        <input type="text" id="login-signup-first-name" name="login-signup-first-name" placeholder="First Name" required>
                        <br /><br />
                    </div>

                        <div class="form-group">
                            <label for="login-signup-last-name">Last Name:</label>
                            <br />
                            <input type="text" id="login-signup-last-name" name="login-signup-last-name" placeholder="Last Name" required>
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-phonenumber">Phonenumber:</label>
                            <br />
                            <input type="tel" id="login-signup-phonenumber" name="login-signup-phonenumber" placeholder="0403685949" required>
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-email">Email:</label>
                            <br />
                            <input type="text" id="login-signup-email" name="login-signup-email" placeholder="example@example.com" required>
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-username">Username:</label>
                            <br />
                            <input type="text" id="login-signup-username" name="login-signup-username" placeholder="John_B" required>
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-password">Password:</label>
                            <br />
                            <input type="password" id="login-signup-password" name="login-signup-password" required>                
                            <br /><br />
                        </div>

                        <div class="form-group">
                            <label for="login-signup-repeat-password">Repeat Password:</label>
                            <br />
                            <input type="password" id="login-signup-repeat-password" name="login-signup-repeat-password" required>                
                            <br /><br />
                        </div>
                        <button type="submit">Submit</button>           
                    </form>
                    <p>Already have an Account? <a href="Login.html">Login</a></p>
                </main>
            </div>
            <div class="image-side">
                <img src="/images/People-Happy.jpg" alt="Signup Illistration">
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="/javascripts/SessionManagerLoginPage.js"></script>
</body>
</html>
